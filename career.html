<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì§„ë¡œí™œë™ ê´€ë¦¬ ì‹œìŠ¤í…œ (Byte ê²½ê³  ì¶”ê°€)</title>
    <style>
      /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", -apple-system, sans-serif;
        background: #f5f6f8;
        color: #333;
        overflow: hidden;
      }
      .topbar {
        height: 48px;
        background: #f5c6cf;
        display: flex;
        align-items: center;
        padding: 0 16px;
        font-weight: 700;
        border-bottom: 1px solid #e5adba;
      }
      .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        height: calc(100vh - 48px);
      }
      .left {
        display: flex;
        flex-direction: column;
        padding: 25px;
        border-right: 1px solid #e5e7eb;
        background: #fff;
        gap: 15px;
      }
      .right {
        padding: 25px;
        display: flex;
        flex-direction: column;
        background: #fff;
      }
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
      }
      .section-title {
        font-size: 16px;
        font-weight: 700;
        color: #1f2937;
      }
      .search-container {
        position: relative;
        width: 100%;
      }
      .autocomplete-list {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #d1d5db;
        border-top: none;
        border-radius: 0 0 8px 8px;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .auto-item {
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
      }
      .auto-item.selected {
        background: #eff6ff;
        color: #1f4ddc;
        font-weight: 600;
      }
      .flex-1 {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .flex-2 {
        flex: 2;
        display: flex;
        flex-direction: column;
      }
      .input,
      .textarea,
      .select {
        width: 100%;
        padding: 10px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
      }
      .textarea {
        flex: 1;
        resize: none;
        line-height: 1.6;
      }
      .btn {
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid #d1d5db;
        background: #fff;
        transition: 0.2s;
      }
      .btn.primary {
        background: #1f4ddc;
        color: #fff;
        border-color: #163aa5;
      }
      .btn.success {
        background: #10b981;
        color: #fff;
        border-color: #059669;
      }
      .btn.accent {
        background: #f59e0b;
        color: #fff;
        border-color: #d97706;
      }
      .btn.sm {
        padding: 4px 8px;
        font-size: 11px;
      }
      .preview-box {
        flex: 1;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 25px;
        font-size: 15px;
        line-height: 1.8;
        white-space: pre-wrap;
        outline: none;
        background: #fff;
        overflow-y: auto;
      }
      .counter {
        text-align: right;
        margin-top: 10px;
        font-size: 13px;
        color: #6b7280;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
      }
      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 1150px;
        height: 85vh;
        background: #fff;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .modal-header {
        padding: 18px 25px;
        background: #f9fafb;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-body {
        display: grid;
        grid-template-columns: 240px 1fr;
        flex: 1;
        overflow: hidden;
      }
      .student-list {
        background: #f8fafc;
        border-right: 1px solid #e5e7eb;
        padding: 20px 0;
        overflow-y: auto;
      }
      .student-item {
        padding: 15px 30px;
        cursor: pointer;
        border-bottom: 1px solid #f1f5f9;
        font-size: 15px;
        transition: 0.2s;
      }
      .student-item:hover {
        background: #f1f5f9;
      }
      .student-item.active {
        background: #eff6ff;
        color: #1f4ddc;
        font-weight: 700;
        border-right: 4px solid #1f4ddc;
      }
      .log-entry {
        padding: 30px;
        overflow-y: auto;
      }
      #toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 13px;
        opacity: 0;
        transition: 0.3s;
        z-index: 3000;
        pointer-events: none;
      }
      .inner-card {
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        background: #f9fafb;
        padding: 15px;
        margin-bottom: 15px;
      }
      .badge {
        font-size: 12px;
        padding: 2px 7px;
        border-radius: 999px;
        background: #eef2ff;
        color: #3730a3;
        font-weight: bold;
        margin-bottom: 10px;
        display: inline-block;
      }
      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 10px;
        background: #f9fafb;
        border-radius: 8px;
        margin-bottom: 8px;
        border: 1px solid #eee;
      }
      .history-content {
        font-size: 13.5px;
        line-height: 1.4;
        flex: 1;
      }
      .history-actions {
        display: flex;
        gap: 5px;
        margin-left: 10px;
      }
      /* --- ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ (í™”ë©´ í­ì´ 768px ì´í•˜ì¼ ë•Œ ì ìš©) --- */
@media (max-width: 768px) {
  
  /* 1. ì „ì²´ ì»¨í…Œì´ë„ˆ í¬ê¸° ì œí•œ í•´ì œ */
  body, .app, .container {
    width: 100% !important;
    height: auto !important;
    min-height: 100vh;
    display: block !important; /* Gridë‚˜ Flexë¥¼ í’€ê³  ë¸”ë¡ìœ¼ë¡œ ë³€ê²½ */
    overflow-y: auto !important; /* ì „ì²´ ìŠ¤í¬ë¡¤ í—ˆìš© */
  }

  /* 2. ì¢Œìš° ë¶„í• ì„ ìƒí•˜ ë°°ì¹˜ë¡œ ë³€ê²½ */
  .container {
    grid-template-columns: 1fr !important; /* 1ì—´ë¡œ ë³€ê²½ */
  }

  /* 3. ì¢Œì¸¡/ìš°ì¸¡ íŒ¨ë„ ìŠ¤íƒ€ì¼ ì¡°ì • */
  .left, .right, .left-panel, .right-panel {
    width: 100% !important;
    height: auto !important;
    border-right: none !important;
    border-bottom: 1px solid #e5e7eb;
    padding: 15px !important;
    overflow: visible !important; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì—†ì• ê³  ì „ì²´ ìŠ¤í¬ë¡¤ë¡œ */
  }

  /* 4. ëª¨ë‹¬ì°½(íŒì—…) ëª¨ë°”ì¼ ìµœì í™” */
  .modal-content {
    width: 95% !important; /* í™”ë©´ ê½‰ ì°¨ê²Œ */
    height: 90vh !important; /* ë†’ì´ë„ ì ë‹¹íˆ */
    top: 50% !important;
    left: 50% !important;
  }
  
  .modal-body {
    grid-template-columns: 1fr !important; /* ì¢Œìš° ë¶„í•  ì œê±° */
    display: flex !important;
    flex-direction: column;
  }

  /* 5. í•™ìƒ ëª©ë¡ ë“± ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ë†’ì´ ì œí•œ */
  .student-list {
    height: 150px !important; /* ëª©ë¡ì€ ì§§ê²Œ */
    border-right: none !important;
    border-bottom: 1px solid #eee;
    overflow-y: auto !important;
  }

  /* 6. í°íŠ¸ ë° ë²„íŠ¼ í¬ê¸° ì¡°ì • (í„°ì¹˜í•˜ê¸° ì¢‹ê²Œ) */
  .btn {
    padding: 12px 15px !important; /* ë²„íŠ¼ ë” í¬ê²Œ */
    font-size: 14px !important;
  }
  
  input, select, textarea {
    font-size: 16px !important; /* ì•„ì´í°ì—ì„œ ì…ë ¥ ì‹œ ì¤Œì¸ ë°©ì§€ */
  }
}
    </style>
  </head>
  <body>
    <div id="toast">ì•Œë¦¼ ë©”ì‹œì§€</div>
    <div class="topbar">ì§„ë¡œí™œë™ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>

    <div class="container">
      <section class="left">
        <div class="section-header">
          <div class="section-title">ì§„ë¡œ ë°ì´í„° ë¡œë“œ ë° ìƒì„±</div>
          <button class="btn accent" onclick="openModal()">
            ğŸ“… ìƒì„¸ ê¸°ë¡ ê´€ë¦¬
          </button>
        </div>

        <div class="search-container">
          <input
            type="text"
            class="input"
            id="studentSearch"
            placeholder="í•™ìƒ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš” (ë°©í–¥í‚¤/ì—”í„° ì‚¬ìš©)"
            autocomplete="off"
          />
          <div id="autoList" class="autocomplete-list"></div>
        </div>

        <div class="flex-1">
          <div class="section-header">
            <label class="section-title">ë¶ˆëŸ¬ì˜¨ ì§„ë¡œ í™œë™ ìš”ì•½</label>
            <button class="btn sm" onclick="loadMainSummary()">
              ğŸ”„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
          </div>
          <textarea
            id="rawDataDisplay"
            class="textarea"
            readonly
            placeholder="íŒì—…ì—ì„œ ì €ì¥ëœ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤."
          ></textarea>
        </div>

        <button
          class="btn primary"
          style="height: 48px; font-size: 15px"
          onclick="generateCareerAI()"
        >
          âœ¨ AI ì§„ë¡œ ë¬¸ì¥ ìƒì„±
        </button>

        <div class="flex-2">
          <label
            class="section-title"
            style="margin-bottom: 8px; display: block"
            >AI ìƒì„± ì´ˆì•ˆ (êµì‚¬ ìˆ˜ì •)</label
          >
          <textarea
            id="tempDraft"
            class="textarea"
            style="background: #fdfbff; border-color: #c7d2fe"
          ></textarea>
          <button
            class="btn success"
            style="width: 100%; margin-top: 10px"
            onclick="moveToFinal()"
          >
            ìš°ì¸¡ ê²°ê³¼ì°½ìœ¼ë¡œ ë³´ë‚´ê¸° â†’
          </button>
        </div>
      </section>

      <section class="right">
        <div class="section-header" style="margin-bottom: 15px">
          <div class="section-title">ì§„ë¡œí™œë™ ìµœì¢… ê¸°ì¬ ë‚´ìš©</div>
          <div style="display: flex; gap: 8px">
            <button
              class="btn"
              onclick="alert('AIê°€ ë¬¸ì¥ íë¦„ê³¼ ë§ì¶¤ë²•ì„ ë³´ì •í•©ë‹ˆë‹¤.')"
            >
              ğŸª„ ì „ì²´ AI ë‹¤ë“¬ê¸°
            </button>
            <button class="btn success" onclick="finalApply()">
              ğŸ’¾ ì ìš©í•˜ê¸°
            </button>
          </div>
        </div>
        <div
          id="finalPreview"
          class="preview-box"
          contenteditable="true"
          oninput="updateByte()"
        >
          í•™ìƒì„ ì„ íƒí•˜ê³  ë¬¸ì¥ì„ ìƒì„±í•´ ì£¼ì„¸ìš”.
        </div>
        <div class="counter">
          ì‹¤ì‹œê°„ ê¸€ììˆ˜:
          <span id="byteCount" style="color: #1f4ddc; font-weight: 700">0</span>
          / 1500 Byte
        </div>
      </section>
    </div>

    <div id="logModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <span style="font-size: 18px; font-weight: 700; color: #374151"
            >ğŸ“… í•™ìƒë³„ ì§„ë¡œ ìƒì„¸ ê¸°ë¡ í†µí•© ê´€ë¦¬</span
          >
          <button class="btn" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
        <div class="modal-body">
          <div class="student-list" id="modalStudentList"></div>
          <div class="log-entry">
            <h3
              id="modalStudentTitle"
              style="
                margin-top: 0;
                margin-bottom: 25px;
                color: #1f4ddc;
                font-size: 22px;
              "
            >
              í•™ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”
            </h3>

            <div
              class="inner-card"
              style="background: #fff; border: 2px solid #eef2ff"
            >
              <span class="badge">1. í¬ë§ ë¶„ì•¼</span>
              <input
                id="hopeField"
                type="text"
                class="input"
                placeholder="ì§„ë¡œê°€ ì—†ê±°ë‚˜ ì •í•˜ëŠ” ì¤‘ì´ë©´ 'ì§„ë¡œ íƒìƒ‰ ì¤‘', 'ë¯¸ì •' ì…ë ¥"
              />
            </div>

            <div
              style="
                background: #f8fafc;
                padding: 25px;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
              "
            >
              <div id="careerItemsContainer"></div>
              <div style="margin-top: 20px; display: flex; gap: 10px">
                <button class="btn sm" onclick="addCareerItem('ê²€ì‚¬')">
                  + ì§„ë¡œ/ì ì„± ê²€ì‚¬ ì¶”ê°€
                </button>
                <button class="btn sm" onclick="addCareerItem('ê°•ì—°')">
                  + ì™¸ë¶€ ê°•ì—° ì¶”ê°€
                </button>
                <button class="btn sm" onclick="addCareerItem('ê¸°íƒ€')">
                  + ê¸°íƒ€ í™œë™ ì¶”ê°€
                </button>
                <button
                  class="btn success"
                  style="margin-left: auto; padding: 10px 25px"
                  onclick="saveToDB()"
                >
                  ğŸ’¾ í˜„ì¬ í•™ìƒ ë°ì´í„° ì €ì¥
                </button>
              </div>
            </div>

            <div
              class="section-title"
              style="margin-top: 40px; font-size: 16px"
            >
              ğŸ•’ ì„ì‹œ ì €ì¥ëœ ê¸°ë¡ ëª©ë¡ (ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
            </div>
            <div
              id="historyListView"
              style="
                margin-top: 15px;
                border: 1px solid #e5e7eb;
                border-radius: 10px;
                padding: 20px;
                background: #fff;
              "
            >
              ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const TEST_OPTIONS = [
        "ì»¤ë¦¬ì–´ë„· ì§ì—…í¥ë¯¸ê²€ì‚¬(Hí˜•)",
        "ì»¤ë¦¬ì–´ë„· ì§ì—…ê°€ì¹˜ê´€ê²€ì‚¬",
        "ì»¤ë¦¬ì–´ë„· ì§ì—…ì ì„±ê²€ì‚¬",
        "ì²­ì†Œë…„ ì§„ë¡œíƒìƒ‰ê²€ì‚¬",
        "ë‹¤ì¤‘ì§€ëŠ¥ ê²€ì‚¬",
      ];
      const RESULT_CATEGORIES = [
        "í˜„ì‹¤í˜•",
        "íƒêµ¬í˜•",
        "ì˜ˆìˆ í˜•",
        "ì‚¬íšŒí˜•",
        "ì§„ì·¨í˜•",
        "ê´€ìŠµí˜•",
        "ëŠ¥ë ¥ë°œíœ˜",
        "ììœ¨ì„±",
        "ì°½ì˜ì„±",
      ];

      const students = ["ì´í˜„íƒœ"];

      let db = {};
      let selectedIndex = -1;
      let currentStudent = "";
      let recordIdCounter = 0;

      window.onload = () => {
        students.forEach((name) => (db[name] = { hope: "", items: [] }));
        initModalList();
      };

      // --- ê²€ìƒ‰ ìë™ì™„ì„± & í‚¤ë³´ë“œ ì¡°ì‘ ---
      const searchInput = document.getElementById("studentSearch");
      const autoList = document.getElementById("autoList");

      searchInput.addEventListener("input", () => {
        const val = searchInput.value;
        autoList.innerHTML = "";
        selectedIndex = -1;
        if (!val) {
          autoList.style.display = "none";
          return;
        }
        const matched = students.filter((s) => s.includes(val));
        matched.forEach((name, idx) => {
          const div = document.createElement("div");
          div.className = "auto-item";
          div.textContent = name;
          div.onclick = () => selectStudent(name);
          autoList.appendChild(div);
        });
        autoList.style.display = matched.length ? "block" : "none";
      });

      searchInput.addEventListener("keydown", (e) => {
        const items = autoList.getElementsByClassName("auto-item");
        if (e.key === "ArrowDown") {
          e.preventDefault();
          selectedIndex++;
          if (selectedIndex >= items.length) selectedIndex = 0;
          updateSelection(items);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          selectedIndex--;
          if (selectedIndex < 0) selectedIndex = items.length - 1;
          updateSelection(items);
        } else if (e.key === "Enter") {
          if (selectedIndex > -1)
            selectStudent(items[selectedIndex].textContent);
          else if (items.length > 0) selectStudent(items[0].textContent);
        }
      });

      function updateSelection(items) {
        Array.from(items).forEach((item, idx) =>
          item.classList.toggle("selected", idx === selectedIndex)
        );
      }
      function selectStudent(name) {
        searchInput.value = name;
        autoList.style.display = "none";
        loadMainSummary();
        showToast(`${name} í•™ìƒì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }

      // --- ëª¨ë‹¬ ë¡œì§ ---
      function openModal() {
        document.getElementById("logModal").style.display = "block";
      }
      function closeModal() {
        document.getElementById("logModal").style.display = "none";
      }
      function showToast(m) {
        const t = document.getElementById("toast");
        t.textContent = m;
        t.style.opacity = 1;
        setTimeout(() => (t.style.opacity = 0), 2000);
      }

      function initModalList() {
        const list = document.getElementById("modalStudentList");
        students.forEach((name) => {
          const div = document.createElement("div");
          div.className = "student-item";
          div.textContent = name;
          div.onclick = () => {
            currentStudent = name;
            document
              .querySelectorAll(".student-item")
              .forEach((i) => i.classList.remove("active"));
            div.classList.add("active");
            document.getElementById(
              "modalStudentTitle"
            ).textContent = `[${name}] í•™ìƒ ì§„ë¡œ ê¸°ë¡ ìƒì„¸`;
            document.getElementById("hopeField").value = db[name].hope;
            renderItemsFromDB();
            renderHistory();
          };
          list.appendChild(div);
        });
      }

      function addCareerItem(type, data = null) {
        if (!currentStudent) return alert("í•™ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");
        const container = document.getElementById("careerItemsContainer");
        const div = document.createElement("div");
        div.className = "inner-card career-input-row";
        div.dataset.id = data ? data.id : recordIdCounter++;

        let contentHtml = `<span class="badge">${type}</span>`;
        if (type === "ê²€ì‚¬") {
          contentHtml += `
                <div style="display:flex; gap:8px; margin-bottom:8px;">
                    <select class="select item-name" style="flex:1;">
                        <option disabled ${
                          !data ? "selected" : ""
                        }>ê²€ì‚¬ ì¢…ë¥˜ ì„ íƒ</option>
                        ${TEST_OPTIONS.map(
                          (o) =>
                            `<option ${
                              data?.name === o ? "selected" : ""
                            }>${o}</option>`
                        ).join("")}
                    </select>
                </div>
                <div style="display:flex; gap:5px; margin-bottom:8px;">
                    <select class="select item-r1" style="flex:1;"><option disabled selected>1ìˆœìœ„</option>${RESULT_CATEGORIES.map(
                      (c) =>
                        `<option ${
                          data?.results?.[0] === c ? "selected" : ""
                        }>${c}</option>`
                    ).join("")}</select>
                    <select class="select item-r2" style="flex:1;"><option disabled selected>2ìˆœìœ„</option>${RESULT_CATEGORIES.map(
                      (c) =>
                        `<option ${
                          data?.results?.[1] === c ? "selected" : ""
                        }>${c}</option>`
                    ).join("")}</select>
                    <select class="select item-r3" style="flex:1;"><option disabled selected>3ìˆœìœ„</option>${RESULT_CATEGORIES.map(
                      (c) =>
                        `<option ${
                          data?.results?.[2] === c ? "selected" : ""
                        }>${c}</option>`
                    ).join("")}</select>
                </div>
            `;
        } else {
          contentHtml += `<input type="text" class="input item-name" style="margin-bottom: 8px;" placeholder="${type}ëª… (ì£¼ì œ) ì…ë ¥" value="${
            data?.name || ""
          }">`;
        }

        contentHtml += `
            <textarea class="textarea item-detail" placeholder="ìƒì„¸ ë‚´ìš© ì…ë ¥">${
              data?.detail || ""
            }</textarea>
            <div style="text-align:right; margin-top:8px;"><button class="btn sm" style="color:red; border-color:#ffcfcf;" onclick="this.closest('.inner-card').remove()">í•­ëª© ì‚­ì œ</button></div>
        `;
        div.innerHTML = contentHtml;
        container.appendChild(div);
      }

      function renderItemsFromDB() {
        const container = document.getElementById("careerItemsContainer");
        container.innerHTML = "";
        db[currentStudent].items.forEach((item) =>
          addCareerItem(item.type, item)
        );
      }

      function saveToDB() {
        if (!currentStudent) return;
        const items = [];
        document.querySelectorAll(".career-input-row").forEach((row) => {
          const type = row.querySelector(".badge").textContent;
          const name = row.querySelector(".item-name").value;
          const detail = row.querySelector(".item-detail").value;
          const id = row.dataset.id;

          const item = { id, type, name, detail };
          if (type === "ê²€ì‚¬") {
            item.results = [
              row.querySelector(".item-r1").value,
              row.querySelector(".item-r2").value,
              row.querySelector(".item-r3").value,
            ].filter((v) => !["1ìˆœìœ„", "2ìˆœìœ„", "3ìˆœìœ„"].includes(v));
          }
          if (name) items.push(item);
        });
        db[currentStudent].hope = document.getElementById("hopeField").value;
        db[currentStudent].items = items;
        renderHistory();
        showToast("ë°ì´í„°ê°€ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }

      function renderHistory() {
        const view = document.getElementById("historyListView");
        const data = db[currentStudent];
        if (!data.items.length && !data.hope) {
          view.innerHTML = "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        let html = `<div><b>í¬ë§ ë¶„ì•¼:</b> ${
          data.hope || "ë¯¸ì •"
        }</div><hr style="border:0; border-top:1px solid #eee; margin:10px 0;">`;
        data.items.forEach((item) => {
          let resText = item.results
            ? ` (ê²°ê³¼: ${item.results.join(", ")})`
            : "";
          html += `
                <div class="history-item">
                    <div class="history-content"><b>[${item.type}] ${item.name}</b>${resText}<br>${item.detail}</div>
                    <div class="history-actions">
                        <button class="btn sm" onclick="editItem('${item.id}')">ìˆ˜ì •</button>
                        <button class="btn sm" style="color:red;" onclick="deleteItem('${item.id}')">ì‚­ì œ</button>
                    </div>
                </div>`;
        });
        view.innerHTML = html;
      }

      function deleteItem(id) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        db[currentStudent].items = db[currentStudent].items.filter(
          (i) => i.id != id
        );
        renderItemsFromDB();
        renderHistory();
      }

      function editItem(id) {
        const item = db[currentStudent].items.find((i) => i.id == id);
        if (!item) return;
        document.getElementById("careerItemsContainer").innerHTML = "";
        addCareerItem(item.type, item);
        showToast("ìˆ˜ì • í›„ ë‹¤ì‹œ 'í˜„ì¬ í•™ìƒ ë°ì´í„° ì €ì¥'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
      }

      function loadMainSummary() {
        const name = searchInput.value;
        if (db[name]) {
          const data = db[name];
          let summary = `[í¬ë§ ë¶„ì•¼] ${
            data.hope || "ë¯¸ì •"
          }\n\n[ì§„ë¡œ í™œë™ ë‚´ì—­]\n`;
          data.items.forEach((item) => {
            let res = item.results ? ` (${item.results.join(", ")})` : "";
            summary += `- ${item.type}: ${item.name}${res} / ${item.detail}\n`;
          });
          document.getElementById("rawDataDisplay").value = summary;
        }
      }

      function generateCareerAI() {
        const name = searchInput.value;
        if (!db[name] || !db[name].items.length)
          return alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        const data = db[name];

        let hopeField = (data.hope || "").trim();
        let isUndecided = ["ë¯¸ì •", "ì§„ë¡œ íƒìƒ‰ ì¤‘", "íƒìƒ‰ ì¤‘", ""].includes(
          hopeField
        );

        let intro = isUndecided
          ? `ì•„ì§ êµ¬ì²´ì ì¸ ì§„ë¡œë¥¼ í™•ì •í•˜ì§€ ì•Šì•˜ìœ¼ë‚˜ ë‹¤ì–‘í•œ í™œë™ì„ í†µí•´ ìì‹ ì˜ ì ì„±ì„ ë‹¤ê°ë„ë¡œ íƒìƒ‰í•˜ê³  ìˆìŒ. `
          : `ìì‹ ì˜ í¬ë§ ë¶„ì•¼ì¸ '${hopeField}'ê³¼ ê´€ë ¨í•˜ì—¬ ëšœë ·í•œ ëª©í‘œ ì˜ì‹ì„ ê°€ì§€ê³  ê¾¸ì¤€íˆ íƒêµ¬í•¨. `;

        let body = "";
        data.items.forEach((item) => {
          if (item.type === "ê²€ì‚¬") {
            body += `${item.name} ê²°ê³¼ ${item.results.join(
              ", "
            )} ì˜ì—­ì—ì„œ ë†’ì€ ì„±í–¥ì„ ë³´ì˜€ìœ¼ë©°, ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ${
              item.detail
            } ë“±ì˜ ê¸ì •ì  ë°˜ì‘ì„ ë³´ì„. `;
          } else {
            body += `ã€Œ${item.name}ã€ ${item.type}ì— ì°¸ì—¬í•˜ì—¬ ${item.detail}ë¥¼(ì„) í†µí•´ ì§„ë¡œ ì˜ì‹ì„ ê³ ì·¨í•¨. `;
          }
        });

        let outro = isUndecided
          ? "ì•ìœ¼ë¡œ ë‹¤ì–‘í•œ ì§„ë¡œ ì²´í—˜ì„ í†µí•´ ìì‹ ì—ê²Œ ë§ëŠ” ê¸¸ì„ ì°¾ì•„ê°ˆ ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë¨."
          : "ì¢…í•©ì ìœ¼ë¡œ ìì‹ ì˜ ê°•ì ì„ ëª…í™•íˆ ì´í•´í•˜ê³  êµ¬ì²´ì ì¸ ì§„ë¡œ ë¡œë“œë§µì„ ì„¤ê³„í•˜ë ¤ëŠ” ë…¸ë ¥ì´ ë§¤ìš° ë‹ë³´ì„.";

        document.getElementById("tempDraft").value = intro + body + outro;
      }

      function moveToFinal() {
        const text = document.getElementById("tempDraft").value;
        const target = document.getElementById("finalPreview");
        if (target.innerText.includes("í•™ìƒì„ ì„ íƒí•˜ê³ ")) target.innerText = "";
        target.innerText += (target.innerText ? "\n\n" : "") + text;
        updateByte();
      }

      function updateByte() {
        const text = document.getElementById("finalPreview").innerText;
        let bytes = 0;
        for (let i = 0; i < text.length; i++)
          bytes += text.charCodeAt(i) > 127 ? 3 : 1;

        // [ìˆ˜ì •] 1500ë°”ì´íŠ¸ ì´ˆê³¼ ì‹œ ë¶‰ì€ìƒ‰ í‘œì‹œ
        const countSpan = document.getElementById("byteCount");
        countSpan.textContent = bytes;
        countSpan.style.color = bytes > 1500 ? "red" : "#1f4ddc";
      }

      function finalApply() {
        alert("ì‘ì„±ëœ ë‚´ìš©ì„ NEISì— ì…ë ¥í•©ë‹ˆë‹¤.");
      }
    </script>
  </body>
</html>
